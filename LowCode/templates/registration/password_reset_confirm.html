{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}Icent低代码平台 - 设置新密码{% endblock %}

{% block extra_css %}
<style>
    /* 复用登录页/重置页的居中容器样式，保持一致性 */
    .confirm-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 180px);
        padding: 2rem 0;
    }

    .confirm-card {
        width: 100%;
        max-width: 420px;
        padding: 2.5rem;
        border-radius: 1rem;
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.08);
    }

    .confirm-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .confirm-logo {
        font-size: 2.5rem;
        color: #0d6efd;
        margin-bottom: 0.75rem;
    }

    /* 密码强度提示样式（新增） */
    .password-hint {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="confirm-container">
    <div class="card confirm-card">
        <!-- 头部区域（与其他页面风格统一） -->
        <div class="confirm-header">
            <i class="bi bi-diagram-3 confirm-logo" aria-hidden="true"></i>
            <h2 class="h4 fw-bold text-dark">设置新密码</h2>
            <p class="text-muted">请输入您的新密码并确认</p>
        </div>

        <!-- 错误提示（如链接失效、令牌错误） -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger mb-3">
                <i class="bi bi-exclamation-circle-fill me-1" aria-hidden="true"></i>
                {% for error in form.non_field_errors %}{{ error }}{% endfor %}
            </div>
        {% endif %}

        <!-- 新密码表单 -->
        <form method="post" novalidate>
            {% csrf_token %}

            <!-- 新密码输入框 -->
            <div class="mb-3">
                <label for="{{ form.new_password1.id_for_label }}" class="form-label">
                    <i class="bi bi-lock me-1" aria-hidden="true"></i> 新密码
                </label>
                <input type="{{ form.new_password1.field.widget.input_type }}"
                       name="{{ form.new_password1.name }}"
                       id="{{ form.new_password1.id_for_label }}"
                       class="form-control {% if form.new_password1.errors %}is-invalid{% endif %}"
                       placeholder="请输入新密码"
                       required>
                {% if form.new_password1.errors %}
                    <div class="invalid-feedback">
                        {% for error in form.new_password1.errors %}{{ error }}{% endfor %}
                    </div>
                {% else %}
                    <div class="password-hint">
                        <i class="bi bi-info-circle me-1" aria-hidden="true"></i>
                        密码长度至少8位，包含字母和数字
                    </div>
                {% endif %}
            </div>

            <!-- 确认新密码输入框 -->
            <div class="mb-4">
                <label for="{{ form.new_password2.id_for_label }}" class="form-label">
                    <i class="bi bi-lock-fill me-1" aria-hidden="true"></i> 确认新密码
                </label>
                <input type="{{ form.new_password2.field.widget.input_type }}"
                       name="{{ form.new_password2.name }}"
                       id="{{ form.new_password2.id_for_label }}"
                       class="form-control {% if form.new_password2.errors %}is-invalid{% endif %}"
                       placeholder="请再次输入新密码"
                       required>
                {% if form.new_password2.errors %}
                    <div class="invalid-feedback">
                        {% for error in form.new_password2.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- 提交按钮 -->
            <button type="submit" class="btn btn-primary w-100 btn-login">
                <i class="bi bi-save me-1" aria-hidden="true"></i> 确认重置密码
            </button>
        </form>

        <!-- 返回登录页 -->
        <div class="mt-4 text-center">
            <p class="text-muted small">
                <a href="{% url 'admin:login' %}" class="text-primary text-decoration-none">
                    返回登录页
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 自动聚焦第一个密码输入框
        const passwordInput = document.getElementById('{{ form.new_password1.id_for_label }}');
        if (passwordInput) {
            passwordInput.focus();
        }

        // 表单提交时添加加载状态
        const confirmForm = document.querySelector('form');
        confirmForm.addEventListener('submit', function() {
            const submitBtn = confirmForm.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner me-2"></span> 提交中...';
        });
    });
</script>
{% endblock %}